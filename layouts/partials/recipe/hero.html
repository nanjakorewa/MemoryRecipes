{{- $page := . -}}
{{- $featured := $page.Params.featured -}}
{{- if not $featured -}}
  {{- $featured = $page.Params.featuredImage -}}
{{- end -}}
{{- $alt := default $page.Title $page.Params.heroAlt -}}
{{- $caption := $page.Params.heroCaption -}}
{{- $resource := cond $featured ($page.Resources.GetMatch $featured) nil -}}
{{- $isResource := $resource -}}
{{- $src := "" -}}
{{- $srcsetEntries := slice -}}
{{- if $resource -}}
  {{- $sizes := slice 400 640 960 1280 -}}
  {{- range $sizes }}
    {{- if ge $resource.Width . -}}
      {{- $variant := $resource.Resize (printf "%dx" .) -}}
      {{- $srcsetEntries = $srcsetEntries | append (printf "%s %dw" $variant.RelPermalink .) -}}
      {{- $src = $variant.RelPermalink -}}
    {{- end -}}
  {{- end -}}
  {{- if not $src -}}
    {{- $src = $resource.RelPermalink -}}
  {{- end -}}
{{- else if $featured -}}
  {{- $src = relURL $featured -}}
{{- end -}}
{{- if $src -}}
  <figure class="recipe-hero">
    <picture>
      <img src="{{ $src }}"{{ with $srcsetEntries }} srcset="{{ delimit . ", " }}" sizes="(max-width: 520px) 92vw, (max-width: 960px) 80vw, 720px"{{ end }} alt="{{ $alt }}" loading="eager" decoding="async" fetchpriority="high" />
    </picture>
    {{- with $caption -}}<figcaption>{{ . }}</figcaption>{{- end -}}
  </figure>
{{- end -}}
